const path = require("path");
const fs = require("fs");
const shell = require("shelljs");
const _ = require("lodash");

const jsonPath = path.resolve(__dirname, "../../dist/protos.json");
if (!fs.existsSync(jsonPath)) {
  console.log("ERROR: protos.json not found in " + jsonPath);
  process.exit(-1);
}

console.log(`// AUTOGENERATED, DO NOT EDIT`);
console.log();
console.log(`module.exports = {`);
const json = _.get(require(jsonPath), "nested");
_.forEach(json, (value, key) => {
  if (_.get(value, "methods")) {
    const methods = _.keys(_.get(value, "methods"));
    const fixedMethods = _.map(methods, (methodName) => {
      return `"${_.lowerFirst(methodName)}"`;
    });
    console.log(`  ${key}: [ ${fixedMethods.join(", ")} ],`);
  }
});
console.log(`}`);
console.log();
